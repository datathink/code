<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Environment variables and keys - DataThink code thoughts</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><link rel=stylesheet href=/css/style.min.de5c38fbc7bf83ad6bc04728975acba5b34d47ab6e5a4aa32d3793388c8e16fe.css><meta name=description content="Programmers often write code that interacts directly with the cloud, requiring private keys. We need our code to be shareable and useable without sharing in the code. Environment variables are the keys to keys."><meta property="og:title" content="Environment variables and keys"><meta property="og:type" content="website"><meta property="og:url" content="/posts/storing_keys/"><meta property="og:description" content="Programmers often write code that interacts directly with the cloud, requiring private keys. We need our code to be shareable and useable without sharing in the code. Environment variables are the keys to keys."><meta name=twitter:card content="summary"><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel=stylesheet></head><body class="page frame page-blog-single"><div id=wrapper class=wrapper><div class=header><a class=header-logo href=/>DataThink code thoughts</a><div class=menu-main><ul><li class=menu-item-posts></li></ul></div></div><div class=blog><div class=author><img width=30 class=author-image src=/img/datathink.gif>
<span class=author-name>DataThink</span>
<span class=author-divider></span><span class=author-date>November 8, 2022</span></div><div class=intro><h1>Environment variables and keys<span class=dot>.</span></h1></div><div class=content><h2 id=environment-variables>Environment Variables</h2><p>Programmers often write code that interacts directly with the cloud, which requires the use of private keys. We need our code to be shareable and useable without sharing secret passwords, usernames, or keys in the code. Environment variables are the key to keys.</p><h3 id=what-is-an-environment-variable>What is an environment variable?</h3><p>An environment variable is a variable that exists outside of your code but is created within your coding environment on startup. Thus each user of your code can use the same variable name but have different values for the variable. Environment files are within the family of <em>dot-files</em> or hidden files on your computer that start with a <code>.</code>. This post focuses on how to access our environment files in R and Python.</p><h3 id=how-do-we-store-information-in-our-environment-file>How do we store information in our environment file?</h3><p>The environment file takes key-value pairs using an <code>=</code> to separate the key and value. You shouldn&rsquo;t have any spaces (<code> </code>) or quotes (<code>"</code>, <code>'</code>) in the file. Here is a simple example.</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>SAFEGRAPH_KEY=L8VjqR9mcuOfIUfgMCsR2NNmQ
GITHUB_PAT=ghp_dQY46I7T778990gggfgfgff0O1y
FAVQS_USER=mom@gmail.com
FAVQS_LOGIN=eatlunch856
</code></pre></div><p>If you use the file browser within VScode, you can see all of your <em>dot-files</em> in any specific folder. You can also create your <code>.env</code> file using the new file option. Additionally, your OS allows you to show hidden files in folders.</p><h2 id=python-and-the-env-file>Python and the <code>.env</code> file</h2><p>Python makes this process relatively easy using the <a href=https://github.com/theskumar/python-dotenv>dotenv</a> and <a href=https://docs.python.org/3/library/os.html#os.environ>os</a> packages.</p><h3 id=creating-the-env-file>Creating the <code>.env</code> file</h3><p>Using the <code>dotenv</code> package, you can store your <code>.env</code> file anywhere in the path from your working directory to the primary directory of your computer. If your environment variables are only needed on a specific project, you can store the <code>.env</code> file in your working directory and add the <code>.env</code> file to your <code>.gitignore</code> file.</p><p>I store my <code>.env</code> file one step up from my working directory to access the environment variables in the file from multiple projects.</p><h3 id=accessing-the-environment-variables>Accessing the environment variables</h3><p>You will need to import the <code>os</code> and <code>dotenv</code> packages within your Python code. The <code>os</code> package comes with Python. However, you will need to install the <code>dotenv</code> package using <code>pip install python-dotenv</code>. With your <code>.env</code> file in your working directory hierarchy, the following code will return the value associated with the key <code>SAFEGRAPH_KEY</code>. You can now use <code>wkey</code> in your code and expect all other users to use <code>wkey</code> but have different keys.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>os</span>
<span class=kn>from</span> <span class=nn>dotenv</span> <span class=kn>import</span> <span class=n>load_dotenv</span>
<span class=n>load_dotenv</span><span class=p>()</span>
<span class=n>wkey</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;SAFEGRAPH_KEY&#34;</span><span class=p>)</span>
</code></pre></div><h2 id=r-and-the-renviron-file>R and the <code>.Renviron</code> file</h2><p>R uses the <code>.Renviron</code> and <code>.Rprofile</code> files to get user-specified environment variables into its environment. Using the <a href=https://usethis.r-lib.org/>usethis</a> you can leverage <code>usethis::edit_r_environ()</code> to automagically open the file and make edits. I like to use <a href=https://posit.co/download/rstudio-desktop/>RStudio</a> with this command as the file opens in the RStudio text editor instead of within the console.</p><p>If you haven&rsquo;t previously used the file, the <code>usethis::edit_r_environ()</code> will open a blank file. You can then create key-value pairs, as shown above.</p><p>With the <code>.Renviron</code> file created, you will have access to your environment variables when R starts. You can bring these variables into your environment using <a href=https://stat.ethz.ch/R-manual/R-devel/library/base/html/Sys.getenv.html><code>Sys.getenv()</code></a></p><div class=highlight><pre class=chroma><code class=language-R data-lang=R><span class=n>wkey</span> <span class=o>&lt;-</span> <span class=nf>Sys.getenv</span><span class=p>(</span><span class=s>&#34;SAFEGRAPH_KEY&#34;</span><span class=p>)</span>
</code></pre></div><h2 id=within-databricks>Within Databricks</h2><p>Two options I have used for my Databricks notebooks are the <code>%run</code> and the environment configuration of the compute. When creating a cluster, you can navigate to the <code>Spark</code> sub-tab at the bottom and enter your <code>Environment variables</code>. These variables are available to every user that has access to the compute.</p><p>I like to use <code>%run ./keys</code> where <em>&lsquo;keys&rsquo;</em> is the name of the notebook I have created that has my keys within it. Using <a href=https://docs.databricks.com/notebooks/notebooks-use.html#use-run-to-import-a-notebook><code>%run</code></a> copies the code from the other notebook and executes it within this notebook. With a few notes in that chunk to tell the other users how to set up their keys, this option works quite well.</p></div></div><div class=footer></div></div><script type=text/javascript src=/js/bundle.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js></script></body></html>